<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>AI Assistant</title>

<!-- PWA -->
<link rel="manifest" href="data:application/json,{
  &quot;name&quot;:&quot;AI Assistant&quot;,
  &quot;short_name&quot;:&quot;AI&quot;,
  &quot;start_url&quot;:&quot;.&quot;,
  &quot;display&quot;:&quot;standalone&quot;,
  &quot;background_color&quot;:&quot;#0f172a&quot;,
  &quot;theme_color&quot;:&quot;#0f172a&quot;,
  &quot;icons&quot;:[]
}">

<style>
:root{
  --bg:#0f172a;
  --panel:#1e293b;
  --text:#e2e8f0;
  --accent:#22d3ee;
}
.light{
  --bg:#ffffff;
  --panel:#f1f5f9;
  --text:#0f172a;
}
body{
  margin:0;
  font-family:Inter,system-ui;
  background:var(--bg);
  color:var(--text);
  display:flex;
  flex-direction:column;
  height:100vh;
}
header{
  padding:15px;
  display:flex;
  justify-content:space-between;
  background:var(--panel);
}
button{
  background:var(--accent);
  border:none;
  padding:8px 14px;
  border-radius:6px;
  cursor:pointer;
}
#chat{
  flex:1;
  overflow:auto;
  padding:20px;
}
.message{
  margin-bottom:15px;
  padding:12px;
  border-radius:8px;
  max-width:80%;
}
.user{
  background:#2563eb;
  margin-left:auto;
}
.ai{
  background:var(--panel);
}
#inputBar{
  display:flex;
  padding:10px;
  background:var(--panel);
}
textarea{
  flex:1;
  resize:none;
  border-radius:6px;
  padding:10px;
}
pre{
  background:#0f172a;
  padding:10px;
  border-radius:6px;
  overflow:auto;
}
</style>
</head>
<body>

<header>
  <div>AI Assistant</div>
  <div>
    <button onclick="toggleTheme()">Theme</button>
    <button onclick="clearMemory()">Clear Memory</button>
  </div>
</header>

<div id="chat"></div>

<div id="inputBar">
  <textarea id="input" rows="2"></textarea>
  <button onclick="send()">Send</button>
  <button onclick="voiceInput()">ðŸŽ¤</button>
</div>

<script>
// ===== CONFIG =====
const API_KEY = "AIzaSyAxP_QN-YULBmrWD0AClnhjmO_yYT8EPJ4";
const MODEL = " gemini-chat"; // change to gpt-4o, gemini, etc.

// ===== MEMORY (Encrypted) =====
const secret = "local_secret_key";

function encrypt(data){
  return btoa(unescape(encodeURIComponent(data)));
}
function decrypt(data){
  try{return decodeURIComponent(escape(atob(data)));}
  catch{return "";}
}

function saveMemory(mem){
  localStorage.setItem("ai_memory", encrypt(JSON.stringify(mem)));
}
function loadMemory(){
  let d = localStorage.getItem("ai_memory");
  return d ? JSON.parse(decrypt(d)) : [];
}

let conversation = loadMemory();

// ===== THEME =====
function toggleTheme(){
  document.body.classList.toggle("light");
}

// ===== CHAT RENDER =====
function addMessage(role,text){
  const div=document.createElement("div");
  div.className="message "+(role==="user"?"user":"ai");
  div.innerHTML=formatText(text);
  document.getElementById("chat").appendChild(div);
  document.getElementById("chat").scrollTop=999999;
}

// ===== FORMAT (Code Highlight) =====
function formatText(text){
  return text
  .replace(/```(.*?)```/gs,"<pre>$1</pre>")
  .replace(/\n/g,"<br>");
}

// ===== TYPING EFFECT =====
async function typeMessage(text){
  const div=document.createElement("div");
  div.className="message ai";
  document.getElementById("chat").appendChild(div);
  for(let i=0;i<text.length;i++){
    div.innerHTML=formatText(text.slice(0,i+1));
    await new Promise(r=>setTimeout(r,10));
  }
  document.getElementById("chat").scrollTop=999999;
}

// ===== SEND =====
async function send(){
  const input=document.getElementById("input");
  const msg=input.value.trim();
  if(!msg)return;

  addMessage("user",msg);
  conversation.push({role:"user",content:msg});
  input.value="";

  const response=await fetch("https://api.deepseek.com/chat/completions",{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      "Authorization":"Bearer "+API_KEY
    },
    body:JSON.stringify({
      model:MODEL,
      messages:conversation
    })
  });

  const data=await response.json();
  const reply=data.choices[0].message.content;

  conversation.push({role:"assistant",content:reply});
  saveMemory(conversation);
  typeMessage(reply);

  speak(reply);
}

// ===== CLEAR MEMORY =====
function clearMemory(){
  localStorage.removeItem("ai_memory");
  conversation=[];
  document.getElementById("chat").innerHTML="";
}

// ===== VOICE INPUT =====
function voiceInput(){
  const recognition=new(window.SpeechRecognition||window.webkitSpeechRecognition)();
  recognition.lang="en-US";
  recognition.start();
  recognition.onresult=e=>{
    document.getElementById("input").value=e.results[0][0].transcript;
  };
}

// ===== VOICE OUTPUT =====
function speak(text){
  const utter=new SpeechSynthesisUtterance(text);
  speechSynthesis.speak(utter);
}

// ===== FILE UPLOAD =====
const fileInput=document.createElement("input");
fileInput.type="file";
fileInput.style.display="none";
fileInput.onchange=e=>{
  const file=e.target.files[0];
  const reader=new FileReader();
  reader.onload=()=>{
    document.getElementById("input").value="File content:\n"+reader.result;
  };
  reader.readAsText(file);
};
document.body.appendChild(fileInput);

// ===== TOOL CALLING (Calculator) =====
function calculate(expr){
  try{return eval(expr);}
  catch{return "Invalid expression";}
}

// ===== PWA SERVICE WORKER =====
if("serviceWorker" in navigator){
  const swCode=`
  self.addEventListener('install',e=>self.skipWaiting());
  self.addEventListener('fetch',e=>{});
  `;
  const blob=new Blob([swCode],{type:"text/javascript"});
  navigator.serviceWorker.register(URL.createObjectURL(blob));
}

</script>
</body>
</html>
